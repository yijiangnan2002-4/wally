<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>AB158x Series DSP API Reference: Preloader_pisplit</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="airoha.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AB158x Series DSP API Reference
   &#160;<span id="projectnumber">Airoha IoT SDK for BT Audio</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__preloader__pisplit.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Preloader_pisplit<div class="ingroups"><a class="el" href="group__kernel__service.html">Kernel_service</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This section describes the programming interfaces of the preloader_pisplit driver.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Overview</h2>
<p>This section describes the programming interfaces of the preloader_pisplit driver. </p>
<h1><a class="anchor" id="Perloader_Pisplit_Terms_Chapter"></a>
Terms and acronyms</h1>
<p>The following provides descriptions to the terms commonly used in the preloader driver and how to use its various functions.</p>
<table class="doxtable">
<tr>
<th>Terms </th><th>Details  </th></tr>
<tr>
<td><b>PI</b> </td><td>Position-Independent. </td></tr>
<tr>
<td><b>PIC</b> </td><td>Position-Independent-Code. </td></tr>
<tr>
<td><b>split</b> </td><td>means one PIC library code and data region can be loaded to two difference regions. </td></tr>
<tr>
<td><b>pisplit</b> </td><td>the pisplit library must have memory blocks - one writable and executable for code part and one writable for data part. </td></tr>
<tr>
<td><b>preloader</b> </td><td>Use DMA to do pre-load the library. </td></tr>
<tr>
<td><b>I/D</b> <b>RAM</b> </td><td>DSP local instruction RAM and data RAM. </td></tr>
<tr>
<td><b>main</b> <b>program</b> </td><td>A dsp main project, like the project of dsp0_freertos_create_thread, one PIC library must be link with main program to constitute a full DSP project. </td></tr>
<tr>
<td><b>PIC</b> <b>memory</b> <b>pool</b> </td><td>A specified memory pool for PIC library. </td></tr>
<tr>
<td><b>extra</b> <b>memory</b> </td><td>Just a speical memory type, DSP1 free I/DRAM are extra memory pools for DSP0. </td></tr>
</table>
<h1><a class="anchor" id="Perloader_Pisplit_Features_Chapter"></a>
Supported features</h1>
<p>Preloader diagram as below: </p><div class="image">
<img src="preloader_Standard_PIC_solution_introduction.png" alt="preloader_Standard_PIC_solution_introduction.png"/>
</div>
<p> Features supported by this module are listed below:</p><ul>
<li><b>Position-Independent</b> <b>Libraries</b>.<br />
 The Position-Independent Libraries feature is Cadence standard service,please reference Cadence document of "Xtensa System Software Reference Manual.pdf", as the chapter of "4.3 Position-Independent Libraries" description:<br />
 "A position-independent library can be loaded and run at any address that supports both code and data, like normal system RAM. Alternatively,you can use the pisplitload LSP to load code and data into separate memory blocks in the local RAM.
. It is not necessary to decide on the location of the library until run time. Because their locations are not fixed, a variety of position-independent libraries can be loaded at the same time, without deciding at build time which sets are possible. For example, if you have five codecs, and three can be loaded at the same time, then they could be loaded in ten different combinations, which is too many to feasibly link in fixed-locations. Position-independent libraries solve that problem by allowing the codecs to be loaded in arbitrary locations and in an arbitrary order."<br />
 <b>Advantages:</b> Flexibility: Several dynamic location libraries can be loaded in arbitrary combinations at arbitrary locations, all of which is decided at run-time.<br />
 <b>Disadvantages:</b> Performance: A position-independent library must be compiled as position-independent code. This is marginally slower than position-dependent code.<br />
</li>
<li><b>Preloader</b> <b>Position-Independent</b> <b>Libraries</b> .<br />
 We provide a mechanism to load pisplit libraries by DMA. Because loading a library image from Flash to DSP local memory need takes time, you can load the libraries in advance. It invokes a callback function to notify that that load is complete.<br />
 To use this mechanism, you can save MCU MIPS and speed up the action of loading libraries. </li>
</ul>
<h1><a class="anchor" id="Perloader_Pisplit_Memory_Chapter"></a>
The Required Resources of the Preloader</h1>
<ul>
<li><b>Pisplit</b> <b>libraries</b> <b>build</b> <b>environment</b>.<br />
 The pisplit libraries build another set of things that are different to the set built by the main program. These types of libraries must be built with the compile option of "-fpic". The reference makefile of "dsp\project\ab1558_evk\templates\dsp_pisplit_library_build_demo\dsp0\Makefile"; Please first clone this file when you create your own library.<br />
</li>
<li><b>Main</b> <b>program</b> <b>link</b> <b>the</b> <b>pisplit</b> <b>libraries</b>.<br />
 The main program must be linked with the pisplit library during the link stage. The pisplit library is different to the general library because its library's symbol is invisible to the main program, it is simply a large array to the main program.<br />
</li>
<li><b>The</b> <b>memory</b> <b>of</b> <b>dynamic</b> <b>allocate</b> <b>by</b> <b>main</b> <b>program</b>.<br />
 DSP must have a dynamically allocated mechanism because runtime is necessary for loading the piplit library to run. We use DSP local memory of I/D RAM as the relocation memory in our DSP SDK reference design. The reference projects will use all the free memory of I/D RAM.<br />
</li>
<li><b>Pre-load</b> <b>image</b>.<br />
 Cadence provides the basic service for loading and relocating the pisplit libraries. The DMA service is necessary because the preloader modifies some of the Cadence service to implement a mechanism of using DMA to do libraries image copy.<br />
</li>
<li><b>The</b> <b>parameters</b> <b>transfer</b> <b>between</b> <b>main</b> <b>program</b> <b>and</b> <b>pisplit</b> <b>libraries</b>.<br />
 The export parameters transfer to main program by pisplit libraries. For example, the pisplit library entry functions must be transferred to the main program, to make sure the library can be correctly called by the main program after it has loaded.<br />
 The import parameters transfer to pisplit libraries by the main program. For example, the pisplit library maybe need to call some basic functions or data defined by main program. You can then transfer it as import parameters. Just use Type Cast to use these symbols in the library.<br />
</li>
</ul>
<h1><a class="anchor" id="Perloader_Pisplit_Library_Build_Chapter"></a>
How to build pisplit libraries</h1>
<ul>
<li><b>Step</b> 1: Create your library files.<br />
 Create your pisplit library file like "dsp\project\ab1558_evk\templates\dsp_pisplit_library_build_demo\dsp0\src\lib_main.c".<br />
<div class="fragment"><div class="line"> <span class="comment">//this is pisplit library code</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"> <span class="keyword">typedef</span> int (*printf_ptr_t)(<span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...);</div><div class="line"></div><div class="line"> printf_ptr_t printf_ptr;</div><div class="line"></div><div class="line"><span class="preprocessor"> #define printf printf_ptr</span></div><div class="line"></div><div class="line"> <span class="keywordtype">char</span> * dsp0_demo_lib_entry_1(<span class="keywordtype">void</span>)</div><div class="line"> {</div><div class="line">  printf(<span class="stringliteral">&quot;executing function dsp0_demo_lib_entry_1\n&quot;</span>);</div><div class="line">  <span class="keywordflow">return</span> <span class="stringliteral">&quot;this string returned from dsp0_demo_lib_entry_1&quot;</span>;</div><div class="line"> }</div><div class="line"> <span class="keywordtype">char</span> * dsp0_demo_lib_entry_2(<span class="keywordtype">void</span>)</div><div class="line"> {</div><div class="line">  printf(<span class="stringliteral">&quot;executing function dsp0_demo_lib_entry_2\n&quot;</span>);</div><div class="line">  <span class="keywordflow">return</span> <span class="stringliteral">&quot;this string returned from dsp0_demo_lib_entry_2&quot;</span>;</div><div class="line"> }</div><div class="line"> <span class="keywordtype">char</span> * dsp0_demo_lib_entry_3(<span class="keywordtype">void</span>)</div><div class="line"> {</div><div class="line">  printf(<span class="stringliteral">&quot;executing function dsp0_demo_lib_entry_3\n&quot;</span>);</div><div class="line">  <span class="keywordflow">return</span> <span class="stringliteral">&quot;this string returned from dsp0_demo_lib_entry_3&quot;</span>;</div><div class="line"> }</div><div class="line"></div><div class="line"> <span class="keywordtype">void</span> * export_parameter_array[3] = {dsp0_demo_lib_entry_1,dsp0_demo_lib_entry_2,dsp0_demo_lib_entry_3};</div><div class="line"></div><div class="line"> <span class="keywordtype">void</span> * _start (<span class="keywordtype">void</span> *p_import_parameters_array[])</div><div class="line"> {</div><div class="line">  printf_ptr = p_import_parameters_array[0];</div><div class="line">  printf(<span class="stringliteral">&quot;dsp0_demo_lib_entry_1:0x%x   dsp0_demo_lib_entry_2:0x%x   dsp0_demo_lib_entry_3:0x%x&quot;</span>,dsp0_demo_lib_entry_1,dsp0_demo_lib_entry_2,dsp0_demo_lib_entry_3);</div><div class="line">  <span class="keywordflow">return</span> export_parameter_array;</div><div class="line"> }</div></div><!-- fragment --> Please pay attention to the following three points:<br />
<ol type="1">
<li>Pisplit library is a stand-alone build system. Please do not reference any symbols defined by other libraries, including the C library.</li>
<li>The export parameters to the main program must be prepared , the same as the sample code symbol of "dsp0_demo_lib_entry_1" and "dsp0_demo_lib_entry_2" and "dsp0_demo_lib_entry_3", the function of "_start" will return the address of "export_parameter_array" to main program. The main program then knows the entry of the library. You can even let the the function of "_start" return a array address which stores more functions or data point, then the main program can get more entries of this library.<br />
</li>
<li>The import parameters to the library must be prepared. The sample code symbol of "printf_func", the function of "_start" can import a parameter when called by the main program. You can import a parameter of the function of "_start" with an array address which stores more functions or data points, then the library can get more import parameters defined by the main program.<br />
</li>
</ol>
</li>
<li><b>Setp</b> 2: Prepare a pisplit library build system.<br />
 You must first clone the makefile of "dsp\project\ab1558_evk\templates\dsp_pisplit_library_build_demo\dsp0\Makefile", then you should make changes for your library:<br />
<ol type="1">
<li>Modify the path of depth, such as the "ROOTDIR" as shown in the following sample code: <div class="fragment"><div class="line"><span class="preprocessor"># module makefile settings</span></div><div class="line"><span class="preprocessor">ROOTDIR       :=  ../../../..</span></div></div><!-- fragment --></li>
<li>Modify your PIC library settings as shown in the following sample code::<br />
 A. PIC_LIB is the final output file path and name. Please pay specific attention to it. You must also have the xxx.o file when the main program links.<br />
 B. PIC is your library name. Please pay specific attention to it. You must use this name to load your library on the main program.<br />
 C. PIC_MODULE_PATH use for identify your library files to build. <div class="fragment"><div class="line"><span class="preprocessor"># PIC settings</span></div><div class="line">PIC      :=  dsp0_pisplit_library_build_demo</div><div class="line"><span class="preprocessor"># PIC_LIB named better is {PIC}.o</span></div><div class="line">PIC_LIB  :=  $(BUILD_LIBDIR)/dsp0_pisplit_library_build_demo.o</div><div class="line"># PIC_DEBUG_LIB named better is {PIC}_position_independent.splitload.lib</div><div class="line">PIC_DEBUG_LIB  :=  $(BUILD_LIBDIR)/dsp0_pisplit_library_build_demo_position_independent.splitload.lib</div><div class="line">PIC_MODULE_PATH := project/ab1558_evk/templates/dsp0_pisplit_library_build_demo</div></div><!-- fragment --> D. Make sure environment variables of DSP core which run the PIC library.<br />
 Make sure to use "xt-xc++" to link.<br />
 Make sure some compile options must be include. Like "-g" is for adding debugging information for the library build.<br />
<div class="fragment"><div class="line">include $(ROOTDIR)/.config.mk</div><div class="line">#<span class="keywordflow">if</span> you want to build dsp0 PIC library,please include dsp0 chip.mk, otherwise please use dsp1 chip.mk.</div><div class="line">#On dsp0 chip.mk will defined the dsp0 core environment variables,like:<span class="stringliteral">&quot;XTENSA_CORE= dsp0_core_winabi_xtensac&quot;</span>.</div><div class="line">include $(ROOTDIR)/config/chip/ab155x/dsp0/chip.mk</div><div class="line"><span class="preprocessor">#include $(ROOTDIR)/config/chip/ab155x/dsp0/chip.mk</span></div><div class="line"></div><div class="line"><span class="preprocessor"># Compile option settings</span></div><div class="line">LD = xt-xc++</div><div class="line">CFLAGS  +=  -O2 -Wall -g  -mlongcalls -fmessage-length=0</div></div><!-- fragment --> E. Add your source file to build, as shown below: C_SRC for adding your xxx.c files, and ASM_SRC for adding your xxx.s files.INC for adding your header file path.<br />
<div class="fragment"><div class="line"><span class="preprocessor"># Source file settings</span></div><div class="line">C_SRC  +=  $(strip $(PIC_MODULE_PATH))/src/lib_main.c</div><div class="line">ASM_SRC      +=</div><div class="line"><span class="preprocessor"># Include path settings</span></div><div class="line"><span class="preprocessor">INC  +=  $(strip $(PIC_MODULE_PATH))/inc</span></div></div><!-- fragment --> If your PIC library also need to include some static library files, for example xa_aac_loas_dec.a as shown below : <div class="fragment"><div class="line"><span class="preprocessor"># .o objects &amp; .d dependency list</span></div><div class="line">PICSL_LIBRARY_OBJS = $(C_SRC:%.c=$(OUTDIR)/%.picsl.o)</div><div class="line">PICSL_LIBRARY_OBJS += $(ASM_SRC:%.S=$(OUTDIR)/%.picsl.o)</div><div class="line"><span class="preprocessor"># Please add this line to here.</span></div><div class="line"><span class="preprocessor">PICSL_LIBRARY_OBJS += $(ROOTDIR)/xxxxxx/xa_aac_loas_dec.a</span></div></div><!-- fragment --> F. There are three actions for this step. It is not necessary to use modify.<br />
 First, build your xxx.c and xxx.s file to obj file.<br />
 Next, link all obj files to a lib file, named by "PIC_DEBUG_LIB" in Step C, it and will also generate the library asm file:"{xxx}_position_independent.splitload.lib.asm",also for debug.<br />
 Finally, package the loadable library into an object file using the Xtensa tool of xt-pkg-loadlib. This generates the final output filenamed by "PIC_LIB" during Step C.<br />
<div class="fragment"><div class="line">all :  $(PIC_LIB)</div><div class="line">    @echo Build $(PIC_LIB) Done</div><div class="line"></div><div class="line">$(OUTDIR)/%.picsl.o :  $(ROOTDIR)/%.S</div><div class="line">    @mkdir -p $(dir $@)</div><div class="line">    $(AS) $(ASFLAG) $(INC:%=-I<span class="stringliteral">&quot;$(ROOTDIR)/%&quot;</span>) -fpic -o $@ -c $^</div><div class="line"></div><div class="line">$(OUTDIR)/%.picsl.o :  $(ROOTDIR)/%.c</div><div class="line">    @mkdir -p $(dir $@)</div><div class="line">    $(CC) $(CFLAGS) $(INC:%=-I<span class="stringliteral">&quot;$(ROOTDIR)/%&quot;</span>) -fpic -o $@ -c $^</div><div class="line"></div><div class="line">$(PIC_DEBUG_LIB) : $(PICSL_LIBRARY_OBJS)</div><div class="line">    @<span class="keywordflow">if</span> [ -e <span class="stringliteral">&quot;$@&quot;</span> ]; then rm -f <span class="stringliteral">&quot;$@&quot;</span>; fi</div><div class="line">    @mkdir -p $(dir $@)</div><div class="line">    $(LD) $(CFLAGS) -mlsp=pisplitload -Wl,--shared-pagesize=128  $^ \ -Wl,-pie -o $@</div><div class="line">    @$(OBJDUMP) -d $@ &gt; $@.asm</div><div class="line"></div><div class="line">$(PIC_LIB) : $(PIC_DEBUG_LIB)</div><div class="line">    @<span class="keywordflow">if</span> [ -e <span class="stringliteral">&quot;$@&quot;</span> ]; then rm -f <span class="stringliteral">&quot;$@&quot;</span>; fi</div><div class="line">    @mkdir -p $(dir $@)</div><div class="line">    xt-pkg-loadlib -p -e $(PIC) -o $@ $^</div></div><!-- fragment --> Note: After library built will generate the three files under path of "dsp\project\ab1558_evk\templates\dsp_pisplit_library_build_demo\dsp0\Build\lib". these are very important:<br />
<ul>
<li>The &lt;xxx.o&gt; file need to link with main program.<br />
</li>
<li>The &lt;xxx_position_independent.splitload.lib&gt; file is for online and offline debug.<br />
</li>
<li>The &lt;xxx_position_independent.splitload.lib.asm&gt; file is the library assembly code, also for debug.<br />
 please keep and provide them when debug library. For AAC library as example, Airoha had put the three files in the path of “dsp/prebuilt/middleware/dspalg/third_party/aac_decoder/pisplit”.<br />
</li>
</ul>
</li>
</ol>
</li>
<li><b>Step</b> 3: You can now build your library and change directory to the makefile path to use the "make" command to build. You must first "make clean".<br />
</li>
<li><b>Step</b> 4: Linking the pisplit library with main program.<br />
 Firstly, user should makesure "PRELOADER_ENABLE = y" on by project file of feature.mk, like "dsp\project\ab1558_evk\templates\dsp0_freertos_create_thread\XT-XCC\feature.mk". Then user should add "kernel/service/pre_libloader/dsp0/module.mk" to the by project file of Makefile. Please refer to the template of "dsp\project\ab1558_evk\templates\dsp0_freertos_create_thread\XT-XCC\Makefile", add your library xxx.o as shown below:<br />
<div class="fragment"><div class="line"> include $(ROOTDIR)/kernel/service/pre_libloader/dsp0/module.mk</div><div class="line">################################################################################</div><div class="line"># PIC lib# User can also add the dsp0_pisplit_library_build_demo.o in your owner module.mk, and include the sub module.mk on your Makefile</div><div class="line"># tempate of <span class="stringliteral">&quot;dsp\kernel\service\pre_libloader\dsp0\dsp0_pic_demo_portable\module.mk&quot;</span>.</div><div class="line">###############################################################################</div><div class="line">PIC     += $(ROOTDIR)/project/ab1558_evk/templates/dsp_pisplit_library_build_demo/dsp0/Build/lib/dsp0_pisplit_library_build_demo.o</div><div class="line">PIC     += $(ROOTDIR)/project/ab1558_evk/templates/dsp_pisplit_library_build_demo/dsp1/Build/lib/dsp1_pisplit_library_build_demo.o</div><div class="line">###############################################################################</div><div class="line"></div><div class="line">PROJ_C_SRC   +=  $(strip $(PROJ_PATH))/src/preloader_pisplit_configure.c</div></div><!-- fragment --></li>
<li><b>Step</b> 5: Start to run(please refer the chapter of How to use preloader of pisplit drivers).<br />
</li>
</ul>
<h1><a class="anchor" id="Perloader_Pisplit_Library_Driver_Chapter"></a>
How to use preloader of pisplit drivers</h1>
<p>Diagram as below: </p><div class="image">
<img src="preloader_How_to_run_PIC_library_single_core.png" alt="preloader_How_to_run_PIC_library_single_core.png"/>
</div>
<ul>
<li><b>Step</b> 1: You should add your pisplit library to the main program in this step. Please create preloader configure files in your project path. Please refer to "dsp\project\ab1558_evk\templates\dsp0_freertos_create_thread\inc\preloader_pisplit_configure.h","dsp\project\ab1558_evk\templates\dsp0_freertos_create_thread\src\preloader_pisplit_configure.c" and make the following changes:<br />
<ol type="1">
<li>Define memory for pisplit libraries. On our SDK reference design, will use DSP local I/D RAM free memory for pisplit libraries. User also can define others memory pools for pisplit libraries, for example,there is a sysram free memory pool, user can define it on preloader_pisplit_configure.c.<br />
<div class="fragment"><div class="line"> <span class="comment">//this is the main program preloader_pisplit_configure.c</span></div><div class="line"><a class="code" href="structpreloader__pisplit__pool__info__t.html">preloader_pisplit_pool_info_t</a> preloader_pisplit_customer_static_pools[] =</div><div class="line">{</div><div class="line">    {<span class="comment">//SYSRAM   Just a sample, sysram both can run code and data, so can define the type is PRELOADER_I_LOW_PERFORMANCE|PRELOADER_D_LOW_PERFORMANCE.</span></div><div class="line">        sysram_for_pisplit_start,</div><div class="line">        sysram_for_pisplit_end,</div><div class="line">        <a class="code" href="group__preloader__enum.html#ggaf1359f845ace09ade712c90e967694d7acd4ef326eba0a1f20d1dfc16354bf4de">PRELOADER_I_LOW_PERFORMANCE</a>|<a class="code" href="group__preloader__enum.html#ggaf1359f845ace09ade712c90e967694d7a8962550387c0016d13bc93b675015df1">PRELOADER_D_LOW_PERFORMANCE</a></div><div class="line">    },</div><div class="line">    {<span class="comment">//PSRAM    Just a sample, psram both can run code and data, so can define the type is PRELOADER_I_LOW_PERFORMANCE|PRELOADER_D_LOW_PERFORMANCE.</span></div><div class="line">        psram_for_pisplit_start,</div><div class="line">        psram_for_pisplit_end,</div><div class="line">        <a class="code" href="group__preloader__enum.html#ggaf1359f845ace09ade712c90e967694d7acd4ef326eba0a1f20d1dfc16354bf4de">PRELOADER_I_LOW_PERFORMANCE</a>|<a class="code" href="group__preloader__enum.html#ggaf1359f845ace09ade712c90e967694d7a8962550387c0016d13bc93b675015df1">PRELOADER_D_LOW_PERFORMANCE</a></div><div class="line">    },</div><div class="line">    {<span class="comment">//IRAM</span></div><div class="line">        (<span class="keywordtype">void</span> *)_preloader_pic_iram_start,</div><div class="line">        (uint32_t)_preloader_pic_iram_end,</div><div class="line">        <a class="code" href="group__preloader__enum.html#ggaf1359f845ace09ade712c90e967694d7afe1d489db91175621ada66638182bea7">PRELOADER_I_HIGH_PERFORMANCE</a></div><div class="line">    },</div><div class="line">    {<span class="comment">//DRAM</span></div><div class="line">        (<span class="keywordtype">void</span> *)_preloader_pic_dram_start,</div><div class="line">        (uint32_t)_preloader_pic_dram_end,</div><div class="line">        <a class="code" href="group__preloader__enum.html#ggaf1359f845ace09ade712c90e967694d7a92dd43b321eb232a0c9db479f177add1">PRELOADER_D_HIGH_PERFORMANCE</a></div><div class="line">    },</div><div class="line">};</div></div><!-- fragment --></li>
<li>preloader_pisplit_configure.h It's the most important step:<br />
 Firstly, you should externally define your library name (it was necessary to define it during Chapter of "How to build pisplit libraries" Step 2.2.C).<br />
 Secondly, you should add your library name to the Macro of "PIC_LIB_LIST". <div class="fragment"><div class="line"><span class="comment">//this is main program code</span></div><div class="line"><span class="keyword">extern</span> xtlib_packaged_library dsp0_pisplit_library_build_demo;<span class="comment">// user must be external to your library to here!</span></div><div class="line"><span class="keyword">extern</span> xtlib_packaged_library dsp1_pisplit_library_build_demo;<span class="comment">// user must be external to your library to here! this is DSP1 PIC library,just for DSP0 help to load DSP1 library to run.</span></div><div class="line"><span class="comment">// user must add your library to this location!</span></div><div class="line"><span class="preprocessor">#define PIC_LIB_LIST    { \</span></div><div class="line"><span class="preprocessor">    &amp;dsp0_pisplit_library_build_demo, \</span></div><div class="line"><span class="preprocessor">    &amp;dsp1_pisplit_library_build_demo,\</span></div><div class="line"><span class="preprocessor">}</span></div></div><!-- fragment --></li>
</ol>
</li>
<li><b>Step</b> 2: Call <a class="el" href="group__preloader__pisplit.html#gafb9f4dbdd65f14ef80eb23cbb5a97972" title="This function initializes the preloader hardware and software with basic functionality. ">preloader_pisplit_init()</a> fucntion in DSPx initialization stage.<br />
<div class="fragment"><div class="line"><span class="comment">//this is main program code</span></div><div class="line"><a class="code" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> err_status;</div><div class="line">err_status = <a class="code" href="group__preloader__pisplit.html#gafb9f4dbdd65f14ef80eb23cbb5a97972">preloader_pisplit_init</a>();</div><div class="line"><span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != err_status)</div><div class="line">{</div><div class="line">    printf(<span class="stringliteral">&quot;preloader_pisplit_init() error code:%d !&quot;</span>,err_status);</div><div class="line">    <span class="keywordflow">while</span>(1);</div><div class="line">}</div></div><!-- fragment --></li>
<li><b>Step</b> 3: Add some memory pools for pisplit libraries. <div class="fragment"><div class="line"> <span class="comment">//there is a function of pisplit_configure_static_pool() defined in preloader_pisplit_configure.c. User can call pisplit_configure_static_pool() to add your memory pools.</span></div><div class="line"><span class="keywordtype">void</span> pisplit_configure_static_pool()</div><div class="line">{</div><div class="line">    uint32_t count;</div><div class="line">    count = <span class="keyword">sizeof</span>(preloader_pisplit_customer_static_pools)/<span class="keyword">sizeof</span>(<a class="code" href="structpreloader__pisplit__pool__info__t.html">preloader_pisplit_pool_info_t</a>);</div><div class="line">    <a class="code" href="group__preloader__pisplit.html#ga543553785ccda5c2a824369d4096ca7e">preloader_pisplit_add_pools</a>(preloader_pisplit_customer_static_pools,count);</div><div class="line">}</div></div><!-- fragment --></li>
<li><b>Step</b> 4: Define the export/import parameters clear.<br />
 As shown in the description of "How to build pisplit libraries of Step 1.2", you can define your owner type rule of export/import parameters to implement transfer of more than one parameter.<br />
</li>
<li><b>Step</b> 5: To get handle and load your library to run when you need. Notice:Please call it after DMA init done, better in your task.<br />
 You must register user callback by the function of <a class="el" href="group__preloader__pisplit.html#ga55af0a5aa99f894c3a5238f29fca6099" title="This function get handle for a pisplit library. ">preloader_pisplit_get_handle</a> with the second parameter. Transfer the import parameters by the function of <a class="el" href="group__preloader__pisplit.html#ga1c50684b04546f0c6c0faf8539de7988" title="This function do a pisplit library dynamic pre-load. ">preloader_pisplit_load</a> with the second parameter. <div class="fragment"><div class="line"><span class="comment">//this is main program code</span></div><div class="line"><span class="keywordtype">void</span> * import_parameter_array[3] = {printf,NULL,NULL};</div><div class="line"><span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga55af0a5aa99f894c3a5238f29fca6099">preloader_pisplit_get_handle</a>(&amp;p_dsp_pisplit_library_handle,&amp;dsp0_pisplit_library_build_demo,dsp_pisplit_library_build_demo_callback) )</div><div class="line">{</div><div class="line">    printf(<span class="stringliteral">&quot;p_dsp_pisplit_library_handle preloader_pisplit_get_handle() error!!!!  err handle:%x&quot;</span>,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)p_dsp_pisplit_library_handle);</div><div class="line">    <span class="keywordflow">while</span>(1);</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga1c50684b04546f0c6c0faf8539de7988">preloader_pisplit_load</a>(p_dsp_pisplit_library_handle,PRELOADER_EXT_IRAM,PRELOADER_EXT_DRAM) )</div><div class="line">{</div><div class="line">    printf(<span class="stringliteral">&quot;p_dsp_pisplit_library_handle preloader_pisplit_load() error!!!!&quot;</span>);</div><div class="line">    <span class="keywordflow">while</span>(1);</div><div class="line">}</div></div><!-- fragment --></li>
<li><b>Step</b> 6: When transfer done will notice to you by your callback function.<br />
<div class="fragment"><div class="line"> <span class="comment">//this is main program code</span></div><div class="line"><span class="keywordtype">void</span> * import_parameter_array[3] = {printf,NULL,NULL};</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> * (*p_dsp0_demo_lib_entry_1_t) (void);</div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> * (*p_dsp0_demo_lib_entry_2_t) (void);</div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> * (*p_dsp0_demo_lib_entry_3_t) (void);</div><div class="line"></div><div class="line"><span class="preprocessor">#define dsp0_demo_lib_entry_1   ((p_dsp0_demo_lib_entry_1_t)dsp0_pisplit_demo_library_export_parameters[0])</span></div><div class="line"><span class="preprocessor">#define dsp0_demo_lib_entry_2   ((p_dsp0_demo_lib_entry_2_t)dsp0_pisplit_demo_library_export_parameters[1])</span></div><div class="line"><span class="preprocessor">#define dsp0_demo_lib_entry_3   ((p_dsp0_demo_lib_entry_3_t)dsp0_pisplit_demo_library_export_parameters[2])</span></div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> p_dsp_pisplit_library_handle;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dsp_pisplit_library_build_demo_callback(<a class="code" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle)</div><div class="line">{</div><div class="line">  BaseType_t xTaskWokenByPost = pdFALSE;</div><div class="line">  uint32_t *p_export_parameters;</div><div class="line">  p_export_parameters = <a class="code" href="group__preloader__pisplit.html#ga841c95a09338e4fd691810483dcad621">preloader_pisplit_get_export_parameter</a>(handle,import_parameter_array);</div><div class="line">  dsp0_pisplit_demo_library_export_parameters[0] =(<span class="keywordtype">void</span>*)p_export_parameters[0];</div><div class="line">  dsp0_pisplit_demo_library_export_parameters[1] =(<span class="keywordtype">void</span>*)p_export_parameters[1];</div><div class="line">  dsp0_pisplit_demo_library_export_parameters[2] =(<span class="keywordtype">void</span>*)p_export_parameters[2];</div><div class="line">  xSemaphoreGiveFromISR( dsp0_pisplit_demo_library_xSemaphore, &amp;xHigherPriorityTaskWoken );</div><div class="line">}</div></div><!-- fragment --></li>
<li><b>Step</b> 7: Call your PIC library entries in your task after receive the semaphore. Strongly suggest user call your library entry functions on task level,void the IRQ handler execute too long to impact DSP real time performance.<br />
<div class="fragment"><div class="line"><span class="comment">//this is main program code</span></div><div class="line">   dsp0_demo_lib_entry_1();   <span class="comment">//call libray entry 1 function</span></div><div class="line">   dsp0_demo_lib_entry_2(); <span class="comment">//call libray entry 2 function</span></div><div class="line">   dsp0_demo_lib_entry_3(); <span class="comment">//call libray entry 3 function</span></div><div class="line">   <span class="comment">//if need, you can do unload for this library to release more memory.</span></div></div><!-- fragment --></li>
<li><b>Notice:</b> For easier to switch from PIC library to static libary. User can create a portable layer for every library to replace Step 4~7. please reference the standard portable example of "dsp\kernel\service\pre_libloader\dsp0\dsp0_pic_demo_portable" . If defined the option of "DSP0_PISPLIT_DEMO_LIBRARY", will use run this library as PIC mode, otherwise will as static mode. Strongly suggest user should create your own xxx_lib_portable.h and xxx_lib_portable.c follow the demo.<br />
 File of dsp\kernel\service\pre_libloader\dsp0\dsp0_pic_demo_portable\module.mk : <div class="fragment"><div class="line">DSP0_PRE_LOAD_LIB_DEMO = kernel/service/pre_libloader/dsp0/dsp0_pic_demo_portable</div><div class="line"></div><div class="line">ifeq ($(PRELOADER_ENABLE),y)</div><div class="line">ifeq ($(DSP0_PISPLIT_DEMO_LIBRARY),y)</div><div class="line"> <span class="preprocessor">#if enable DSP0_PISPLIT_DEMO_LIBRARY, should extern defined &quot;dsp0_pisplit_library_build_demo&quot; in preloader_pisplit_configure.h, </span></div><div class="line"><span class="preprocessor"> #and add &quot;dsp0_pisplit_library_build_demo&quot; to &quot;PIC_LIB_LIST&quot;</span></div><div class="line"><span class="preprocessor"> #CCFLAG += -DDSP0_PISPLIT_DEMO_LIBRARY  #user can defined to here or dsp\config\chip\ab155x\dsp0\chip.mk</span></div><div class="line"><span class="preprocessor"> #ASFLAG += -DDSP0_PISPLIT_DEMO_LIBRARY  #user can defined to here or dsp\config\chip\ab155x\dsp0\chip.mk</span></div><div class="line"> C_SRC  += $(DSP0_PRE_LOAD_LIB_DEMO)/dsp0_pisplit_demo_library_portable.c</div><div class="line"> # Notice: <span class="keywordflow">if</span> add your library obj file to here, then no need add the obj file again on Makefile, just include <span class="keyword">this</span> module.mk to Makefile or your own module.mk.</div><div class="line"> PIC     += $(ROOTDIR)/project/ab1558_evk/templates/dsp_pisplit_library_build_demo/dsp0/Build/lib/dsp0_pisplit_library_build_demo.o</div><div class="line"><span class="preprocessor"> #else</span></div><div class="line"><span class="preprocessor"> # user can include your static lib xxx.a to here, then the option of &quot;DSP0_PISPLIT_DEMO_LIBRARY&quot; if not defined, will use this static library!!!</span></div><div class="line">endif</div><div class="line">endif</div><div class="line"><span class="preprocessor">#################################################################################</span></div><div class="line"><span class="preprocessor">#include path</span></div><div class="line"><span class="preprocessor">INC  += kernel/service/pre_libloader/dsp0/dsp0_pic_demo_portable</span></div></div><!-- fragment --> File of dsp\kernel\service\pre_libloader\dsp0\dsp0_pic_demo_portable\dsp0_pisplit_demo_library_portable.h : <div class="fragment"><div class="line"><span class="preprocessor">#ifdef DSP0_PISPLIT_DEMO_LIBRARY</span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> * (*p_dsp0_demo_lib_entry_1_t) (void);</div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> * (*p_dsp0_demo_lib_entry_2_t) (void);</div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> * (*p_dsp0_demo_lib_entry_3_t) (void);</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> *dsp0_pisplit_demo_library_import_parameters[];</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> *dsp0_pisplit_demo_library_export_parameters[];</div><div class="line"></div><div class="line"><span class="preprocessor">#define dsp0_demo_lib_entry_1   ((p_dsp0_demo_lib_entry_1_t)dsp0_pisplit_demo_library_export_parameters[0])</span></div><div class="line"><span class="preprocessor">#define dsp0_demo_lib_entry_2   ((p_dsp0_demo_lib_entry_2_t)dsp0_pisplit_demo_library_export_parameters[1])</span></div><div class="line"><span class="preprocessor">#define dsp0_demo_lib_entry_3   ((p_dsp0_demo_lib_entry_3_t)dsp0_pisplit_demo_library_export_parameters[2])</span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> dsp0_pisplit_demo_library_load();</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> dsp0_pisplit_demo_library_unload();</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --> File of dsp\kernel\service\pre_libloader\dsp0\dsp0_pic_demo_portable\dsp0_pisplit_demo_library_portable.c : <div class="fragment"><div class="line"><span class="preprocessor">#ifdef DSP0_PISPLIT_DEMO_LIBRARY</span></div><div class="line">SemaphoreHandle_t dsp0_pisplit_demo_library_xSemaphore = NULL;</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> dsp0_pisplit_demo_library_default_function_parameter();</div><div class="line"><span class="keywordtype">void</span> *dsp0_pisplit_demo_library_export_parameters[3] = {dsp0_pisplit_demo_library_default_function_parameter,</div><div class="line">                                                        dsp0_pisplit_demo_library_default_function_parameter,</div><div class="line">                                                        dsp0_pisplit_demo_library_default_function_parameter};</div><div class="line"><span class="keywordtype">void</span> *dsp0_pisplit_demo_library_import_parameters[1] = {printf};</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dsp0_pisplit_demo_library_default_function_parameter()</div><div class="line">{</div><div class="line">    printf(<span class="stringliteral">&quot;function point is NULL!!! dsp0_pisplit_demo_library not load or had been unload!!!&quot;</span>);</div><div class="line">    assert(0);</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> p_dsp_pisplit_library_handle = NULL;</div><div class="line"><span class="keywordtype">void</span> dsp0_pisplit_demo_library_callback(<a class="code" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle)</div><div class="line">{</div><div class="line">    BaseType_t xHigherPriorityTaskWoken = pdFALSE;</div><div class="line">    uint32_t *p_export_parameters;</div><div class="line">    p_export_parameters = <a class="code" href="group__preloader__pisplit.html#ga841c95a09338e4fd691810483dcad621">preloader_pisplit_get_export_parameter</a>(handle,dsp0_pisplit_demo_library_import_parameters);</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;*p_export_parameters:0x%x&quot;</span>,*p_export_parameters);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(p_export_parameters == NULL)</div><div class="line">    {</div><div class="line">       printf(<span class="stringliteral">&quot;p_export_parameters is NULL, please check!!!&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">    <span class="comment">//notice:Strongly suggestion: Just do receive parameters on CCNI ISR callback.</span></div><div class="line">    <span class="comment">//                             Then notice your thread that can execute the library entries!!!</span></div><div class="line">        dsp0_pisplit_demo_library_export_parameters[0] =p_export_parameters[0];</div><div class="line">        dsp0_pisplit_demo_library_export_parameters[1] =p_export_parameters[1];</div><div class="line">        dsp0_pisplit_demo_library_export_parameters[2] =p_export_parameters[2];</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_pisplit_demo_library_export_parameters[0]:0x%x&quot;</span>,dsp0_pisplit_demo_library_export_parameters[0]);</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_pisplit_demo_library_export_parameters[1]:0x%x&quot;</span>,dsp0_pisplit_demo_library_export_parameters[1]);</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_pisplit_demo_library_export_parameters[2]:0x%x&quot;</span>,dsp0_pisplit_demo_library_export_parameters[2 ]);</div><div class="line">         xSemaphoreGiveFromISR( dsp0_pisplit_demo_library_xSemaphore, &amp;xHigherPriorityTaskWoken );</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> dsp0_pisplit_demo_library_load()</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (dsp0_pisplit_demo_library_xSemaphore == NULL)</div><div class="line">    {</div><div class="line">        dsp0_pisplit_demo_library_xSemaphore = xSemaphoreCreateBinary();</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>( dsp0_pisplit_demo_library_xSemaphore == NULL )</div><div class="line">        {</div><div class="line">            assert(0);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga55af0a5aa99f894c3a5238f29fca6099">preloader_pisplit_get_handle</a>(&amp;p_dsp_pisplit_library_handle,&amp;dsp0_pisplit_library_build_demo,dsp0_pisplit_demo_library_callback) )</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_pisplit_library_build_demo preloader_pisplit_get_handle() error!!!!&quot;</span>);</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga1c50684b04546f0c6c0faf8539de7988">preloader_pisplit_load</a>(p_dsp_pisplit_library_handle,PRELOADER_I_HIGH_PERFORMANCE,<a class="code" href="group__preloader__enum.html#ggaf1359f845ace09ade712c90e967694d7a92dd43b321eb232a0c9db479f177add1">PRELOADER_D_HIGH_PERFORMANCE</a>) )</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_pisplit_library_build_demo preloader_pisplit_load() error!!!!&quot;</span>);</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">    <span class="comment">//notice: If you want to blocking this task when call load library, you can use this method to wait semaphore,until loading done.</span></div><div class="line">    <span class="comment">//        If you don&#39;t want to blocking this thread, you can miss waiting semaphonre and return directly.</span></div><div class="line">    <span class="comment">//            You should confirm the library had been loading done before call the library entries by yourselves.</span></div><div class="line">    <span class="keywordflow">if</span>(xSemaphoreTake( dsp0_pisplit_demo_library_xSemaphore, portMAX_DELAY) == pdTRUE)</div><div class="line">    {</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> dsp0_pisplit_demo_library_unload()</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga2bff9afe6f5a08fcde9fbf3450f69c74">preloader_pisplit_unload</a>(p_dsp_pisplit_library_handle))</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_pisplit_library_build_demo preloader_pisplit_unload() error!!!!&quot;</span>);</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga1c431d392e5b175370b82e2cfb021f7a">preloader_pisplit_release_handle</a>(p_dsp_pisplit_library_handle))</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_pisplit_library_build_demo preloader_pisplit_release_handle() error!!!!&quot;</span>);</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line"></div><div class="line">    dsp0_pisplit_demo_library_export_parameters[0] = dsp0_pisplit_demo_library_default_function_parameter;</div><div class="line">    p_dsp_pisplit_library_handle = NULL;</div><div class="line">}</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --> The most importance point is that user can use the same function symbol with static library directly, there are advantages:<br />
</li>
</ul>
<ol type="1">
<li>Easier to switch the library from PIC mode to static mode without change any code.</li>
<li>Easy to debug. Can add trace code for library entries functions and send error log when the library not be loaded but the entry have been called. <div class="fragment"><div class="line">dsp0_pisplit_demo_library_load();</div><div class="line"><span class="comment">// call library entries</span></div><div class="line">    dsp0_demo_lib_entry_1();   <span class="comment">//call libray entry 1 function</span></div><div class="line">    dsp0_demo_lib_entry_2(); <span class="comment">//call libray entry 2 function</span></div><div class="line">    dsp0_demo_lib_entry_3(); <span class="comment">//call libray entry 3 function</span></div><div class="line">dsp0_pisplit_demo_library_unload();</div></div><!-- fragment --> </li>
</ol>
<h1><a class="anchor" id="Perloader_Pisplit_Library_DSP0_Load_DSP1_Chapter"></a>
The feature of DSP0 help DSP1 to load PIC library</h1>
<p>If DSP1 just a accelerator for DSP0, and with less memory. Can use this feature which DSP0 help DSP1 to load its PIC library. Then DSP1 can cut down most services like preloader driver and SW DMA driver etc., just use less services of <a class="el" href="group__preloader__pisplit.html#ga841c95a09338e4fd691810483dcad621" title="This function for transfer the import and export parameters between main program and pisplit librarie...">preloader_pisplit_get_export_parameter</a> to get PIC library parameters when DSP0 load library done.<br />
 On the other hand, if DSP1 PIC memory pool was DSP1 free memory, so the information just be known until DSP1 boot up. User can use dynamic memory pool features to resolve this problem.<br />
 Preloader Cross dual cores diagram as below: </p><div class="image">
<img src="preloader_Dual_Core_PIC_solution_introduction.png" alt="preloader_Dual_Core_PIC_solution_introduction.png"/>
</div>
<p> As below just a example of DSP0 want load libraries to DSP1 I/DRAM memory pools.<br />
 <b>Notice1:</b> DSP0 and DSP1 have some communication requirement, please use the module of CCCI. User also can reference the sample file of dsp\project\ab1558_evk\templates\dsp0_freertos_create_thread\inc\ccci_configure.h and dsp\project\ab1558_evk\templates\dsp1_create_message_queue\inc\ccci_configure.h.<br />
 <b>Notice2:</b> There is a important information of when DSP0 access DSP1 I/DRAM, must be guarantee DSP1 core be in active state, because when DSP1 enter sleep, will lead DSP0 access DSP1 I/DRAM fail. So when DSP0 help DSP1 to load library to DSP1 I/DRAM, must be call hal_sleep_manager_lock_sleep(SLEEP_LOCK_DSP1_CROSS_CORE_PRELOADER) to lock DSP1 sleep before any access DSP1 I/DRAM.<br />
 DSP1 how to run the PIC library diagram as below: </p><div class="image">
<img src="preloader_How_to_run_PIC_library_cross_core.png" alt="preloader_How_to_run_PIC_library_cross_core.png"/>
</div>
<p> Please reference the sample of "dsp\kernel\service\pre_libloader\dsp0\dsp0_load_dsp1_pic_demo_portable" and "dsp\kernel\service\pre_libloader\dsp1\dsp1_pic_demo_portable".<br />
</p><ul>
<li><b>Step</b> 1: Define the CCCI event for cross core communication for the feature of DSP0 help DSP1 to load its PIC library.<br />
 For the dsp1 pisplit demo library, we just need several CCCI events cross DSP0 and DSP1. User also can add more events, like: "data is ready" and "process is done". The sample file of dsp\project\ab1558_evk\templates\dsp0_freertos_create_thread\inc\ccci_configure.h <div class="fragment"><div class="line"> <span class="comment">//User should add your event which DSP1 send to DSP0</span></div><div class="line"><span class="preprocessor">#define DSP1_TO_DSP0_CCCI_EVENT_LIST</span></div><div class="line"></div><div class="line"> <span class="comment">// User should add your event which DSP0 send to DSP1</span></div><div class="line"> <span class="comment">//    The event of CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST is mandatory for DSP0 request the information of DSP1 pools, please clone to you project!!!</span></div><div class="line"> <span class="comment">//    The last two events is mandatory for the library of demo library, please clone to you project!!!</span></div><div class="line"> <span class="comment">//    User also can add more events, like: &quot;data is ready&quot; and &quot;process is done&quot;.</span></div><div class="line"><span class="preprocessor">#define DSP0_TO_DSP1_CCCI_EVENT_LIST    \</span></div><div class="line"><span class="preprocessor">                                         CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST,\</span></div><div class="line"><span class="preprocessor">                                         CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_LOAD_DONE,\</span></div><div class="line"><span class="preprocessor">                                         CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_UNLOAD_DONE,</span></div><div class="line"></div><div class="line"> <span class="comment">//User should add your event and callback to here</span></div><div class="line"><span class="preprocessor">#define DSP0_RECEIVE_CCCI_FROM_DSP1_USER_ARRAY</span></div></div><!-- fragment --> The sample file of dsp\project\ab1558_evk\templates\dsp1_create_message_queue\inc\ccci_configure.h <div class="fragment"><div class="line">     <span class="keyword">extern</span> <span class="keywordtype">void</span> prepare_pic_pool_info_to_dsp0();</div><div class="line">     <span class="keyword">extern</span> <span class="keywordtype">void</span> dsp1_pisplit_lib_demo_load_done();</div><div class="line">     <span class="keyword">extern</span> <span class="keywordtype">void</span> dsp1_pisplit_lib_demo_unload_done();</div><div class="line"></div><div class="line">     <span class="comment">//User should add your event which DSP1 send to DSP0</span></div><div class="line"><span class="preprocessor">#define DSP1_TO_DSP0_CCCI_EVENT_LIST</span></div><div class="line"></div><div class="line">     <span class="comment">// User should add your event which DSP0 send to DSP1</span></div><div class="line">     <span class="comment">//   The event of CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST is mandatory for DSP0 request the information of DSP1 pools, please clone to you project!!!</span></div><div class="line">     <span class="comment">//   The last two events is mandatory for the library of demo library, please clone to you project!!!</span></div><div class="line">     <span class="comment">//   User also can add more events, like: &quot;data is ready&quot; and &quot;process is done&quot;.</span></div><div class="line"><span class="preprocessor">#define DSP0_TO_DSP1_CCCI_EVENT_LIST    \</span></div><div class="line"><span class="preprocessor">                                             CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST,\</span></div><div class="line"><span class="preprocessor">                                             CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_LOAD_DONE,\</span></div><div class="line"><span class="preprocessor">                                             CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_UNLOAD_DONE,</span></div><div class="line"></div><div class="line">     <span class="comment">//User should add your event and callback to here</span></div><div class="line">     <span class="comment">//The event of CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST is mandatory for DSP0 request the information of DSP1 pools, please clone to you project!!!</span></div><div class="line">     <span class="comment">//The last callbacks just for the demo library control, if you want to create new library, please clone.</span></div><div class="line"><span class="preprocessor">#define DSP1_RECEIVE_CCCI_FROM_DSP0_USER_ARRAY  \</span></div><div class="line"><span class="preprocessor">                  {CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST, prepare_pic_pool_info_to_dsp0},\</span></div><div class="line"><span class="preprocessor">                  {CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_LOAD_DONE, dsp1_pisplit_lib_demo_load_done},\</span></div><div class="line"><span class="preprocessor">                  {CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_UNLOAD_DONE, dsp1_pisplit_lib_demo_unload_done}, *</span></div></div><!-- fragment --></li>
<li><b>Step</b> 2: DSP0 should request the DSP1 memory pools information via CCCI event of CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST. And DSP0 add the pools to preloader driver. Then the DSP0 can help DSP1 to load its PIC library.<br />
 User need define a structure of dynamic pool for DSP0 preloader_pisplit driver to manage DSP1 free I/DRAM memory pool. After DSP1 boot up, DSP0 should request DSP1 to prepare the memory pools information and write to this structure. User must pay attention to this key point of the structure of preloader_pisplit_customer_dynamic_pools. Because of it defined and read on DSP0 side, and write on DSP1 side. To void will be have data coherency issue, user should guarantee the structure must be non-cacheable for DSP0 and DSP1.<br />
 DSP0 side sample code, file of dsp\project\ab1558_evk\templates\dsp0_freertos_create_thread\src\preloader_pisplit_configure.c: <div class="fragment"><div class="line"><span class="comment">//User must pay attention to this key point of the structure of preloader_pisplit_customer_dynamic_pools.</span></div><div class="line"><span class="comment">//Because of it defined and read on DSP0 side, and write on DSP1 side. To void will be have data coherency issue,</span></div><div class="line"><span class="comment">//user should guarantee the structure must be non-cacheable for DSP0 and DSP1.</span></div><div class="line"><span class="comment">//On this example project, RW data default put on DSP0 DRAM, should it is non-cacheable for DSP0.</span></div><div class="line"><span class="comment">//Because DSP1 have no cache, so DSP0 DRAM also non-cacheable for DSP1.</span></div><div class="line"><a class="code" href="structpreloader__pisplit__pool__info__t.html">preloader_pisplit_pool_info_t</a> preloader_pisplit_customer_dynamic_pools[] =</div><div class="line">{</div><div class="line">    {<span class="comment">//dsp1 iram</span></div><div class="line">        NULL,</div><div class="line">       0,</div><div class="line">        PRELOADER_EXT_IRAM</div><div class="line">    },</div><div class="line">    {<span class="comment">//dsp1 dram</span></div><div class="line">        NULL,</div><div class="line">        0,</div><div class="line">        PRELOADER_EXT_DRAM</div><div class="line">    },</div><div class="line">};</div><div class="line"><span class="preprocessor">#ifdef PRELOADER_ENABLE_DSP0_LOAD_FOR_DSP1</span></div><div class="line"><span class="comment">//This function implement on by project level, for register the dynamic PIC memory pools to Preloader_pisplit driver.</span></div><div class="line"><span class="comment">//For the feature of DSP0 load DSP1 PIC library, also need power on and let DSP1 running firstly, then can call pisplit_configure_dynamic_pool() to</span></div><div class="line"><span class="comment">//register DSP1 I/DRAM to PIC pools, because need power on the memory.</span></div><div class="line"><span class="comment">//Please clone this function to your project!!!</span></div><div class="line"></div><div class="line"><span class="comment">//example code on init flow:</span></div><div class="line"><span class="comment">//   preloader_pisplit_init();</span></div><div class="line"><span class="comment">//   pisplit_configure_static_pool();</span></div><div class="line"><span class="comment">//   printf(&quot;\r\n#### DSP0 Begin to Reset DSP1... ####\r\n&quot;);</span></div><div class="line"><span class="comment">//   hal_dsp_core_reset(HAL_CORE_DSP1, DSP1_BASE);</span></div><div class="line"><span class="comment">// pisplit_configure_dynamic_pool();</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> pisplit_configure_dynamic_pool()</div><div class="line">{</div><div class="line">    <a class="code" href="structccci__msg__t.html">ccci_msg_t</a> ccci_msg;</div><div class="line">    uint32_t pools;</div><div class="line">    ccci_msg.<a class="code" href="structccci__msg__t.html#ae8a28793ab5faf1a334b1ce4fbaab046">event</a> = CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST;</div><div class="line">    ccci_msg.<a class="code" href="structccci__msg__t.html#a1e43bf7d608e87228b625cca2c04d641">data</a> = hal_memview_dsp0_to_infrasys((uint32_t)preloader_pisplit_customer_dynamic_pools);</div><div class="line">    <span class="comment">//send CCCI to DSP1 to request DSP1 I/DRAM free memory,must be wait for got this information</span></div><div class="line">    printf(<span class="stringliteral">&quot;DSP0 to reuqest DSP1 free I/DRAM info...&quot;</span>);</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__ccci__enum.html#gga10afb4a888c55b186bcfa151187e120eab5efba58b9f6e4a12a949ba73c526046">CCCI_STATUS_OK</a> != <a class="code" href="group___c_c_c_i.html#ga2914de3b072e245ce6b2d623912889b6">ccci_send_msg</a>(HAL_CORE_DSP1,ccci_msg,<a class="code" href="group__ccci__enum.html#gga8e66795e857756840140d718cee5230fa2d53c60f8195199f6b334a01ce7fb008">CCCI_SEND_MSG_WAIT_FOR_SEND_RECEIVE_DONE</a>))</div><div class="line">    {</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>( (preloader_pisplit_customer_dynamic_pools[0].pool_start == NULL) || (preloader_pisplit_customer_dynamic_pools[1].pool_start == NULL) )</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;pisplit_configure_dynamic_pool get DSP1 fre I/DRAM fail!!!&quot;</span>);</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">    pools = <span class="keyword">sizeof</span>(preloader_pisplit_customer_dynamic_pools)/<span class="keyword">sizeof</span>(<a class="code" href="structpreloader__pisplit__pool__info__t.html">preloader_pisplit_pool_info_t</a>);</div><div class="line">    <a class="code" href="group__preloader__pisplit.html#ga543553785ccda5c2a824369d4096ca7e">preloader_pisplit_add_pools</a>(preloader_pisplit_customer_dynamic_pools,pools);</div><div class="line">}</div><div class="line">endif</div></div><!-- fragment --> DSP1 side sample code of receive DSP0 request and prepare DSP1 free I/DRAM information for DSP0, file of dsp\project\ab1558_evk\templates\dsp1_create_message_queue\src\preloader_pisplit_configure.c: <div class="fragment"><div class="line"><span class="keyword">extern</span> uint32_t _preloader_pic_iram_start[];    <span class="comment">//this is DSP1 IRAM free start, defined in memory layout link script</span></div><div class="line"><span class="keyword">extern</span> uint32_t _preloader_pic_iram_end[];      <span class="comment">//this is DSP1 IRAM free end, defined in memory layout link script</span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> uint32_t _preloader_pic_dram_start[];    <span class="comment">//this is DSP1 DRAM free start, defined in memory layout link script</span></div><div class="line"><span class="keyword">extern</span> uint32_t _preloader_pic_dram_end[];      <span class="comment">//this is DSP1 DRAM free end, defined in memory layout link script</span></div><div class="line"></div><div class="line"><span class="comment">//For DSP0 help DSP1 to load its PIB library.</span></div><div class="line"><span class="comment">//This function is the callback of  event &lt;CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST&gt;</span></div><div class="line"><span class="comment">//When DSP0 send the event of CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST, the function will be called to prepare DSP1 memory pools information to DSP0.</span></div><div class="line"><span class="comment">//For DSP0 request DSP1 I/D RAM free memory information.</span></div><div class="line"><span class="comment">//User should clone this function to your DSP1 project if you want use the feature of DSP0 load DSP1 PIC library.</span></div><div class="line"><span class="comment">//void prepare_pic_pool_info_to_dsp0(ccci_msg_t ccci_msg)</span></div><div class="line">{</div><div class="line">    <a class="code" href="structpreloader__pisplit__pool__info__t.html">preloader_pisplit_pool_info_t</a> *pool_info;</div><div class="line">    <span class="keywordflow">if</span>(ccci_msg.<a class="code" href="structccci__msg__t.html#ae8a28793ab5faf1a334b1ce4fbaab046">event</a> != CCCI_EVENT_DSP0_TO_DSP1_PIC_MEMORY_REQUEST)</div><div class="line">        assert(0);</div><div class="line"></div><div class="line">    pool_info = hal_memview_infrasys_to_dsp1(ccci_msg.<a class="code" href="structccci__msg__t.html#a1e43bf7d608e87228b625cca2c04d641">data</a>);</div><div class="line">    printf(<span class="stringliteral">&quot;DSP1 prepare pic memory pool...&quot;</span>);</div><div class="line">    pool_info-&gt;<a class="code" href="structpreloader__pisplit__pool__info__t.html#ab0e23c06ee2829185de59a3c2078f54b">pool_start</a> = (<span class="keywordtype">void</span>*)_preloader_pic_iram_start;</div><div class="line">    pool_info-&gt;<a class="code" href="structpreloader__pisplit__pool__info__t.html#ac396453b9bf02a6330bddba8db821f2b">pool_end</a> = (uint32_t)_preloader_pic_iram_end;</div><div class="line">    (pool_info+1)-&gt;pool_start = (<span class="keywordtype">void</span>*)_preloader_pic_dram_start;</div><div class="line">    (pool_info+1)-&gt;pool_end = (uint32_t)_preloader_pic_dram_end;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;DSP1 prepare pic iram memory pool info (start:0x%x,end:0x%x)&quot;</span>,(uint32_t)_preloader_pic_iram_start,(uint32_t)_preloader_pic_iram_end);</div><div class="line">    printf(<span class="stringliteral">&quot;DSP1 prepare pic dram memory pool info (start:0x%x,end:0x%x)&quot;</span>,(uint32_t)_preloader_pic_dram_start,(uint32_t)_preloader_pic_dram_end);</div><div class="line">}</div></div><!-- fragment --></li>
<li><b>Step</b> 3: DSP0 do loading libraries. Should notify DSP1 after loading done.<br />
 So on DSP0 preloader callback should send CCCI event with one word information of handler to DSP1, let DSP1 know the library had been loaded done. Then use the one word information of handler to get the library entry point on DSP1 side. DSP0 side sample code, file of dsp\kernel\service\pre_libloader\dsp0\dsp0_load_dsp1_pic_demo_portable\dsp0_load_dsp1_pisplit_demo_library_portable.c <div class="fragment"><div class="line"><span class="preprocessor">#ifdef PRELOADER_ENABLE_DSP0_LOAD_FOR_DSP1</span></div><div class="line"><span class="preprocessor">#ifdef DSP1_PISPLIT_DEMO_LIBRARY</span></div><div class="line"><a class="code" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> p_dsp0_load_dsp1_pisplit_library_handle;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dsp0_load_dsp1_pisplit_demo_library_callback(<a class="code" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle)</div><div class="line">{</div><div class="line">    <a class="code" href="structccci__msg__t.html">ccci_msg_t</a> ccci_msg;</div><div class="line">    printf(<span class="stringliteral">&quot;this is dsp0_load_dsp1_pisplit_demo_library_callback&quot;</span>);</div><div class="line">    <span class="comment">//just for error check and debug</span></div><div class="line">    <span class="comment">//if(handle != p_dsp0_load_dsp1_pisplit_library_handle)</span></div><div class="line">    <span class="comment">//{</span></div><div class="line">    <span class="comment">//     printf(&quot;main error !!! p_dsp0_load_dsp1_pisplit_library_handle=0x%x handle=0x%x ---&quot;,(uint32_t)p_dsp0_load_dsp1_pisplit_library_handle,(uint32_t)handle);</span></div><div class="line">    <span class="comment">//}</span></div><div class="line">    <span class="comment">//printf(&quot;p_dsp0_load_dsp1_pisplit_library_handle:0x%x&quot;,(uint32_t)p_dsp0_load_dsp1_pisplit_library_handle);</span></div><div class="line">    ccci_msg.<a class="code" href="structccci__msg__t.html#ae8a28793ab5faf1a334b1ce4fbaab046">event</a> = CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_LOAD_DONE;</div><div class="line">    ccci_msg.<a class="code" href="structccci__msg__t.html#a1e43bf7d608e87228b625cca2c04d641">data</a> = hal_memview_dsp0_to_infrasys((uint32_t)handle);</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__ccci__enum.html#gga10afb4a888c55b186bcfa151187e120eab5efba58b9f6e4a12a949ba73c526046">CCCI_STATUS_OK</a> != <a class="code" href="group___c_c_c_i.html#ga2914de3b072e245ce6b2d623912889b6">ccci_send_msg</a>(HAL_CORE_DSP1,ccci_msg,<a class="code" href="group__ccci__enum.html#gga8e66795e857756840140d718cee5230fa5dfeef3d8e71bf498e6d493538ecbe53">CCCI_SEND_MSG_NO_WAIT</a>))</div><div class="line">    {</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dsp0_load_dsp1_pisplit_demo_library_load()</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga55af0a5aa99f894c3a5238f29fca6099">preloader_pisplit_get_handle</a>(&amp;p_dsp0_load_dsp1_pisplit_library_handle,&amp;dsp1_pisplit_library_build_demo,dsp0_load_dsp1_pisplit_demo_library_callback) )</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_load_dsp1_pisplit_demo_library_load preloader_pisplit_get_handle() error!!!!&quot;</span>);</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga1c50684b04546f0c6c0faf8539de7988">preloader_pisplit_load</a>(p_dsp0_load_dsp1_pisplit_library_handle,PRELOADER_EXT_IRAM,PRELOADER_EXT_DRAM) )</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_load_dsp1_pisplit_demo_library_load preloader_pisplit_load() error!!!!&quot;</span>);</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dsp0_load_dsp1_pisplit_demo_library_unload()</div><div class="line">{</div><div class="line">    <a class="code" href="structccci__msg__t.html">ccci_msg_t</a> ccci_msg;</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga2bff9afe6f5a08fcde9fbf3450f69c74">preloader_pisplit_unload</a>(p_dsp0_load_dsp1_pisplit_library_handle))</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_load_dsp1_pisplit_demo_library_unload preloader_pisplit_unload() error!!!!&quot;</span>);</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> != <a class="code" href="group__preloader__pisplit.html#ga1c431d392e5b175370b82e2cfb021f7a">preloader_pisplit_release_handle</a>(p_dsp0_load_dsp1_pisplit_library_handle))</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;dsp0_load_dsp1_pisplit_demo_library_unload preloader_pisplit_release_handle() error!!!!&quot;</span>);</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line"></div><div class="line">    ccci_msg.<a class="code" href="structccci__msg__t.html#ae8a28793ab5faf1a334b1ce4fbaab046">event</a> = CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_UNLOAD_DONE;</div><div class="line">    ccci_msg.<a class="code" href="structccci__msg__t.html#a1e43bf7d608e87228b625cca2c04d641">data</a> = 0;</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group__ccci__enum.html#gga10afb4a888c55b186bcfa151187e120eab5efba58b9f6e4a12a949ba73c526046">CCCI_STATUS_OK</a> != <a class="code" href="group___c_c_c_i.html#ga2914de3b072e245ce6b2d623912889b6">ccci_send_msg</a>(HAL_CORE_DSP1,ccci_msg,<a class="code" href="group__ccci__enum.html#gga8e66795e857756840140d718cee5230fa5dfeef3d8e71bf498e6d493538ecbe53">CCCI_SEND_MSG_NO_WAIT</a>))</div><div class="line">    {</div><div class="line">        assert(0);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --></li>
<li><b>Step</b> 4: DSP1 can call <a class="el" href="group__preloader__pisplit.html#ga841c95a09338e4fd691810483dcad621" title="This function for transfer the import and export parameters between main program and pisplit librarie...">preloader_pisplit_get_export_parameter()</a> to put and get parameter to use the libraries.<br />
</li>
<li><b>Step</b> 5: DSP0 do unloading libraries. Should can notify DSP1 after unloading done.<br />
 DSP1 side sample code, file of dsp\kernel\service\pre_libloader\dsp1\dsp1_pic_demo_portable\dsp1_pisplit_demo_library_portable.h <div class="fragment"><div class="line"><span class="preprocessor">#ifdef DSP1_PISPLIT_DEMO_LIBRARY</span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> * (*p_dsp1_demo_lib_entry_1_t) (void);</div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> * (*p_dsp1_demo_lib_entry_2_t) (void);</div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> * (*p_dsp1_demo_lib_entry_3_t) (void);</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> *dsp1_pisplit_demo_library_import_parameters[];</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> *dsp1_pisplit_demo_library_export_parameters[];</div><div class="line"><span class="preprocessor">#define dsp1_demo_lib_entry_1    ((p_dsp1_demo_lib_entry_1_t)dsp1_pisplit_demo_library_export_parameters[0])</span></div><div class="line"><span class="preprocessor">#define dsp1_demo_lib_entry_2    ((p_dsp1_demo_lib_entry_2_t)dsp1_pisplit_demo_library_export_parameters[1])</span></div><div class="line"><span class="preprocessor">#define dsp1_demo_lib_entry_3    ((p_dsp1_demo_lib_entry_3_t)dsp1_pisplit_demo_library_export_parameters[2])</span></div><div class="line"><span class="comment">// **********************************************************************</span></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --> DSP1 side sample code, file of dsp\kernel\service\pre_libloader\dsp1\dsp1_pic_demo_portable\dsp1_pisplit_demo_library_portable.c <div class="fragment"><div class="line"><span class="preprocessor">#ifdef DSP1_PISPLIT_DEMO_LIBRARY</span></div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> dsp1_pisplit_demo_library_default_function_parameter();</div><div class="line"><span class="keywordtype">void</span> *dsp1_pisplit_demo_library_export_parameters[3] = {dsp1_pisplit_demo_library_default_function_parameter,</div><div class="line">                                                        dsp1_pisplit_demo_library_default_function_parameter,</div><div class="line">                                                        dsp1_pisplit_demo_library_default_function_parameter};</div><div class="line"><span class="keywordtype">void</span> *dsp1_pisplit_demo_library_import_parameters[1] = {printf};</div><div class="line"><span class="keywordtype">void</span> dsp1_pisplit_demo_library_default_function_parameter()</div><div class="line">{</div><div class="line">    printf(<span class="stringliteral">&quot;function point is NULL!!! dsp1_pisplit_demo_library not load or had been unload!!!&quot;</span>);</div><div class="line">    assert(0);</div><div class="line">}</div><div class="line"><a class="code" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> p_dsp1_pisplit_demo_library_handle = NULL;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dsp1_pisplit_lib_demo_load_done(<a class="code" href="structccci__msg__t.html">ccci_msg_t</a> ccci_msg)</div><div class="line">{</div><div class="line">    uint32_t *p_export_parameters;</div><div class="line">    uint32_t data = ccci_msg.<a class="code" href="structccci__msg__t.html#a1e43bf7d608e87228b625cca2c04d641">data</a>;</div><div class="line">    <span class="keywordflow">if</span>(ccci_msg.<a class="code" href="structccci__msg__t.html#ae8a28793ab5faf1a334b1ce4fbaab046">event</a> != CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_LOAD_DONE)</div><div class="line">        assert(0);</div><div class="line">    p_dsp1_pisplit_demo_library_handle = hal_memview_infrasys_to_dsp1(data);</div><div class="line">    printf(<span class="stringliteral">&quot;p_dsp1_pisplit_demo_library_handle:0x%x&quot;</span>,(uint32_t)p_dsp1_pisplit_demo_library_handle);</div><div class="line"></div><div class="line">    p_export_parameters = <a class="code" href="group__preloader__pisplit.html#ga841c95a09338e4fd691810483dcad621">preloader_pisplit_get_export_parameter</a>(p_dsp1_pisplit_demo_library_handle,dsp1_pisplit_demo_library_import_parameters);</div><div class="line">    <span class="keywordflow">if</span>(p_export_parameters == NULL)</div><div class="line">    {</div><div class="line">       printf(<span class="stringliteral">&quot;p_export_parameters is NULL, please check!!!&quot;</span>);</div><div class="line">       assert(0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">    <span class="comment">//notice:Strongly suggestion: Just do receive parameters on CCNI ISR callback. </span></div><div class="line">    <span class="comment">//                              Then notice your thread that can execute the library entries!!!</span></div><div class="line">        dsp1_pisplit_demo_library_export_parameters[0] =p_export_parameters[0];</div><div class="line">        dsp1_pisplit_demo_library_export_parameters[1] =p_export_parameters[1];</div><div class="line">        dsp1_pisplit_demo_library_export_parameters[2] =p_export_parameters[2];</div><div class="line">        printf(<span class="stringliteral">&quot;dsp1_pisplit_demo_library_export_parameters[0]:0x%x&quot;</span>,dsp1_pisplit_demo_library_export_parameters[0]);</div><div class="line">        printf(<span class="stringliteral">&quot;dsp1_pisplit_demo_library_export_parameters[1]:0x%x&quot;</span>,dsp1_pisplit_demo_library_export_parameters[1]);</div><div class="line">        printf(<span class="stringliteral">&quot;dsp1_pisplit_demo_library_export_parameters[2]:0x%x&quot;</span>,dsp1_pisplit_demo_library_export_parameters[2 ]);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> dsp1_pisplit_lib_demo_unload_done(<a class="code" href="structccci__msg__t.html">ccci_msg_t</a> ccci_msg)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span>(ccci_msg.<a class="code" href="structccci__msg__t.html#ae8a28793ab5faf1a334b1ce4fbaab046">event</a> != CCCI_EVENT_DSP0_TO_DSP1_PIC_DEMO_LIBRARY_UNLOAD_DONE)</div><div class="line">        assert(0);</div><div class="line"></div><div class="line">    dsp1_pisplit_demo_library_export_parameters[0] =dsp1_pisplit_demo_library_default_function_parameter;</div><div class="line">    dsp1_pisplit_demo_library_export_parameters[1] =dsp1_pisplit_demo_library_default_function_parameter;</div><div class="line">    dsp1_pisplit_demo_library_export_parameters[2] =dsp1_pisplit_demo_library_default_function_parameter;</div><div class="line">}</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --> DSP1 side sample code, user can call the library entries on user thread. <div class="fragment"><div class="line">dsp1_demo_lib_entry_1();</div><div class="line">dsp1_demo_lib_entry_2();</div><div class="line">dsp1_demo_lib_entry_3();</div></div><!-- fragment --> Notice: As the description above, DSP1 side just need one API of <a class="el" href="group__preloader__pisplit.html#ga841c95a09338e4fd691810483dcad621" title="This function for transfer the import and export parameters between main program and pisplit librarie...">preloader_pisplit_get_export_parameter</a> when DSP0 help DSP1 to load PIC library.<br />
</li>
</ul>
<h1><a class="anchor" id="Perloader_Pisplit_Library_How_To_Debug_Chapter"></a>
How to debug pisplit library</h1>
<p>Xplorer or Xtensa OCD both support pisplit library debugging and they must both have the library lib file: "dsp\project\ab1558_evk\templates\dsp_pisplit_library_build_demo\dsp0\Build\lib\dsp0_pisplit_library_build_demo_position_independent.splitload.lib".<br />
</p><ul>
<li><b>How</b> <b>to</b> <b>debug</b> <b>with</b> <b>Xplorer</b>.<br />
<ul>
<li><b>Step</b> 1: Debug main program success.<br />
</li>
<li><b>Step</b> 2: Must get the relocation address of the running library.<br />
 You can get the address using one of two methods:<ol type="1">
<li>Refer to the log. When library loaded, the address is sent as "###debug###important info## the (xtlib_pi_library_debug_addr) lib_info.text_addr:0x300410f0". The address of 0x300410f0 is the library relocation address.<br />
</li>
<li>Use online debugging to see the variable of "g_preloader_pisplit_library_info[x].lib_info.text_addr" to get the address.<br />
</li>
</ol>
</li>
<li><b>Step</b> 3: Add library debug symbol.<br />
<ol type="1">
<li>Select and right click the menu of "Debug Program".<br />
</li>
<li>Select and right click the menu of "Load Alternate Symbols".<br />
</li>
<li>Select and right click the menu of "Select...".<br />
 <div class="image">
<img src="preloader_how_to_debug_with_Xplorer_1.png" alt="preloader_how_to_debug_with_Xplorer_1.png"/>
</div>
</li>
<li>Select the menu of "Add these new symbols to currently ...".<br />
</li>
<li>Write the running library relocation address.</li>
<li>Select the menu of "Choose from file system" and find the file of xxx_position_independent.splitload.lib.<br />
</li>
<li>Click the button of "OK".<br />
 <div class="image">
<img src="preloader_how_to_debug_with_Xplorer_2.png" alt="preloader_how_to_debug_with_Xplorer_2.png"/>
</div>
</li>
</ol>
</li>
<li><b>Step</b> 4: Then your library symbol will be add success. <div class="image">
<img src="preloader_how_to_debug_with_Xplorer_3.png" alt="preloader_how_to_debug_with_Xplorer_3.png"/>
</div>
</li>
</ul>
</li>
<li><b>How</b> <b>to</b> <b>debug</b> <b>with</b> <b>Xtensa</b> <b>OCD</b>.<br />
 The operations are very similar to the Xplorer procedure. Simply replace the Step 3 to use the cmd of "add-symbol-file Z:\\dsp\\project\\ab1558_evk\\templates\\dsp_pisplit_library_build_demo\\dsp0\\Build\\lib\\dsp_pisplit_library_build_demo_position_independent.splitload.lib 0x300410f0".<br />
 </li>
</ul>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gafb9f4dbdd65f14ef80eb23cbb5a97972"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#gafb9f4dbdd65f14ef80eb23cbb5a97972">preloader_pisplit_init</a> (void)</td></tr>
<tr class="memdesc:gafb9f4dbdd65f14ef80eb23cbb5a97972"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function initializes the preloader hardware and software with basic functionality.  <a href="#gafb9f4dbdd65f14ef80eb23cbb5a97972">More...</a><br /></td></tr>
<tr class="separator:gafb9f4dbdd65f14ef80eb23cbb5a97972"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga55af0a5aa99f894c3a5238f29fca6099"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga55af0a5aa99f894c3a5238f29fca6099">preloader_pisplit_get_handle</a> (<a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> *handle, xtlib_packaged_library *library, <a class="el" href="group__preloader__typedef.html#gab7234fa6840759b265598e3af2513a8e">preloader_pisplit_customer_callback_t</a> complete_callback_func)</td></tr>
<tr class="memdesc:ga55af0a5aa99f894c3a5238f29fca6099"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function get handle for a pisplit library.  <a href="#ga55af0a5aa99f894c3a5238f29fca6099">More...</a><br /></td></tr>
<tr class="separator:ga55af0a5aa99f894c3a5238f29fca6099"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga543553785ccda5c2a824369d4096ca7e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga543553785ccda5c2a824369d4096ca7e">preloader_pisplit_add_pools</a> (<a class="el" href="structpreloader__pisplit__pool__info__t.html">preloader_pisplit_pool_info_t</a> preloader_pisplit_pools[], uint32_t pools_number)</td></tr>
<tr class="memdesc:ga543553785ccda5c2a824369d4096ca7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function add memory pools for pisplit libraries.  <a href="#ga543553785ccda5c2a824369d4096ca7e">More...</a><br /></td></tr>
<tr class="separator:ga543553785ccda5c2a824369d4096ca7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1c50684b04546f0c6c0faf8539de7988"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga1c50684b04546f0c6c0faf8539de7988">preloader_pisplit_load</a> (<a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle, <a class="el" href="group__preloader__enum.html#gaf1359f845ace09ade712c90e967694d7">preloader_pisplit_memory_type_t</a> code_memory_type, <a class="el" href="group__preloader__enum.html#gaf1359f845ace09ade712c90e967694d7">preloader_pisplit_memory_type_t</a> data_memory_type)</td></tr>
<tr class="memdesc:ga1c50684b04546f0c6c0faf8539de7988"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function do a pisplit library dynamic pre-load.  <a href="#ga1c50684b04546f0c6c0faf8539de7988">More...</a><br /></td></tr>
<tr class="separator:ga1c50684b04546f0c6c0faf8539de7988"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0be55ca5ee945631146c0291a7fcc35f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga0be55ca5ee945631146c0291a7fcc35f">preloader_pisplit_get_library_code_and_data_size</a> (<a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle, unsigned int *code_size, unsigned int *data_size)</td></tr>
<tr class="memdesc:ga0be55ca5ee945631146c0291a7fcc35f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function to get the code size and data size of a pisplit library.  <a href="#ga0be55ca5ee945631146c0291a7fcc35f">More...</a><br /></td></tr>
<tr class="separator:ga0be55ca5ee945631146c0291a7fcc35f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2a542fdc86ca0e5395e94a467986f559"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga2a542fdc86ca0e5395e94a467986f559">preloader_pisplit_load_v1</a> (<a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle, void *code_load_address, void *data_load_address)</td></tr>
<tr class="memdesc:ga2a542fdc86ca0e5395e94a467986f559"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function do a pisplit library dynamic pre-load.  <a href="#ga2a542fdc86ca0e5395e94a467986f559">More...</a><br /></td></tr>
<tr class="separator:ga2a542fdc86ca0e5395e94a467986f559"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga04a5fdc6b0c14927994b671aff2e8566"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga04a5fdc6b0c14927994b671aff2e8566">preloader_pisplit_unload_v1</a> (<a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle)</td></tr>
<tr class="memdesc:ga04a5fdc6b0c14927994b671aff2e8566"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function do a pisplit library unload.  <a href="#ga04a5fdc6b0c14927994b671aff2e8566">More...</a><br /></td></tr>
<tr class="separator:ga04a5fdc6b0c14927994b671aff2e8566"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2bff9afe6f5a08fcde9fbf3450f69c74"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga2bff9afe6f5a08fcde9fbf3450f69c74">preloader_pisplit_unload</a> (<a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle)</td></tr>
<tr class="memdesc:ga2bff9afe6f5a08fcde9fbf3450f69c74"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function do a pisplit library unload.  <a href="#ga2bff9afe6f5a08fcde9fbf3450f69c74">More...</a><br /></td></tr>
<tr class="separator:ga2bff9afe6f5a08fcde9fbf3450f69c74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga841c95a09338e4fd691810483dcad621"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga841c95a09338e4fd691810483dcad621">preloader_pisplit_get_export_parameter</a> (<a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle, void *p_import_parameters[])</td></tr>
<tr class="memdesc:ga841c95a09338e4fd691810483dcad621"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function for transfer the import and export parameters between main program and pisplit libraries.  <a href="#ga841c95a09338e4fd691810483dcad621">More...</a><br /></td></tr>
<tr class="separator:ga841c95a09338e4fd691810483dcad621"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf5cff19f051f69fd7835b81d6dd99bcc"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#gaf5cff19f051f69fd7835b81d6dd99bcc">preloader_pisplit_malloc_memory</a> (<a class="el" href="group__preloader__enum.html#gaf1359f845ace09ade712c90e967694d7">preloader_pisplit_memory_type_t</a> memory_type, uint32_t size)</td></tr>
<tr class="memdesc:gaf5cff19f051f69fd7835b81d6dd99bcc"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function for malloc memory from preloader pisplit heap memory.  <a href="#gaf5cff19f051f69fd7835b81d6dd99bcc">More...</a><br /></td></tr>
<tr class="separator:gaf5cff19f051f69fd7835b81d6dd99bcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga06b05dbc40a605fc36f6b0a13e37e792"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga06b05dbc40a605fc36f6b0a13e37e792">preloader_pisplit_free_memory</a> (void *buffer_addr)</td></tr>
<tr class="memdesc:ga06b05dbc40a605fc36f6b0a13e37e792"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function for free memory from preloader pisplit heap memory.  <a href="#ga06b05dbc40a605fc36f6b0a13e37e792">More...</a><br /></td></tr>
<tr class="separator:ga06b05dbc40a605fc36f6b0a13e37e792"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac4df48348af53f9cf1988a8a79f94058"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#gac4df48348af53f9cf1988a8a79f94058">preloader_pisplit_get_max_free_block_size</a> (<a class="el" href="group__preloader__enum.html#gaf1359f845ace09ade712c90e967694d7">preloader_pisplit_memory_type_t</a> memory_type)</td></tr>
<tr class="memdesc:gac4df48348af53f9cf1988a8a79f94058"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function for query the max size of continuous memory block in the preloader pisplit heap memory.  <a href="#gac4df48348af53f9cf1988a8a79f94058">More...</a><br /></td></tr>
<tr class="separator:gac4df48348af53f9cf1988a8a79f94058"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac1e985c28b7067ed407d83867e8b3945"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#gac1e985c28b7067ed407d83867e8b3945">preloader_pisplit_query_library_size</a> (<a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle, uint32_t *p_code_size, uint32_t *p_data_size)</td></tr>
<tr class="memdesc:gac1e985c28b7067ed407d83867e8b3945"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function for query the library relocation size.  <a href="#gac1e985c28b7067ed407d83867e8b3945">More...</a><br /></td></tr>
<tr class="separator:gac1e985c28b7067ed407d83867e8b3945"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1c431d392e5b175370b82e2cfb021f7a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__pisplit.html#ga1c431d392e5b175370b82e2cfb021f7a">preloader_pisplit_release_handle</a> (<a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> handle)</td></tr>
<tr class="memdesc:ga1c431d392e5b175370b82e2cfb021f7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function do a pisplit library handle release.  <a href="#ga1c431d392e5b175370b82e2cfb021f7a">More...</a><br /></td></tr>
<tr class="separator:ga1c431d392e5b175370b82e2cfb021f7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__preloader__define"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__define.html">Define</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__preloader__enum"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__enum.html">Enum</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__preloader__struct"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__struct.html">Struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__preloader__typedef"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__preloader__typedef.html">Typedef</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga543553785ccda5c2a824369d4096ca7e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_add_pools </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structpreloader__pisplit__pool__info__t.html">preloader_pisplit_pool_info_t</a>&#160;</td>
          <td class="paramname"><em>preloader_pisplit_pools</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>pools_number</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function add memory pools for pisplit libraries. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">preloader_pisplit_pools</td><td>user need to define which pools will used by pisplit libraries. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pools_number</td><td>how many pools need added on this time. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>User must define a customized pools for pisplit libraries,like:preloader_pisplit_configure.c User can call this function more than one time, for add difference pools on difference time, for example, use can define some static pools and call this function when system initialization phase. Also can prepare some dynmaic pools by run time to call this function. </dd></dl>

</div>
</div>
<a class="anchor" id="ga06b05dbc40a605fc36f6b0a13e37e792"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_free_memory </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer_addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function for free memory from preloader pisplit heap memory. </p>
<p><br />
</p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*buffer_addr</td><td>defined buffer address.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
</dd></dl>

</div>
</div>
<a class="anchor" id="ga841c95a09338e4fd691810483dcad621"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* preloader_pisplit_get_export_parameter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a>&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_import_parameters</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function for transfer the import and export parameters between main program and pisplit libraries. </p>
<p>After called <a class="el" href="group__preloader__pisplit.html#ga1c50684b04546f0c6c0faf8539de7988" title="This function do a pisplit library dynamic pre-load. ">preloader_pisplit_load()</a>, when the libraries loading done. User can call this function on the customer callback to do parameters transfer. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*handle</td><td>specifies user pisplit library handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*p_import_parameters</td><td>specifies the input parameter for the library, for example, the library want to call some symbols defined by main program, the symbols can be transfered by this parameter. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>User call this memory can free the memory allocated by this library. </dd></dl>

</div>
</div>
<a class="anchor" id="ga55af0a5aa99f894c3a5238f29fca6099"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_get_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a> *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">xtlib_packaged_library *&#160;</td>
          <td class="paramname"><em>library</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#gab7234fa6840759b265598e3af2513a8e">preloader_pisplit_customer_callback_t</a>&#160;</td>
          <td class="paramname"><em>complete_callback_func</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function get handle for a pisplit library. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*handle</td><td>defined by user and to get the pisplit library handle by this function. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*library</td><td>specifies the pisplit library. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">complete_callback_func</td><td>specifies the callback function called by preloader DMA irq handler when pre-load library done. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>User must call <a class="el" href="group__preloader__pisplit.html#gafb9f4dbdd65f14ef80eb23cbb5a97972" title="This function initializes the preloader hardware and software with basic functionality. ">preloader_pisplit_init()</a> before calling this function. User can call the function one time for one library just for get the handle. </dd></dl>

</div>
</div>
<a class="anchor" id="ga0be55ca5ee945631146c0291a7fcc35f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_get_library_code_and_data_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a>&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>code_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>data_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function to get the code size and data size of a pisplit library. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*handle</td><td>specifies user pisplit library handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">code_size</td><td>specifies code size in memory. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_size</td><td>specifies data size in memory. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>User must the pisplit library handle before calling this function. </dd></dl>

</div>
</div>
<a class="anchor" id="gac4df48348af53f9cf1988a8a79f94058"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t preloader_pisplit_get_max_free_block_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__enum.html#gaf1359f845ace09ade712c90e967694d7">preloader_pisplit_memory_type_t</a>&#160;</td>
          <td class="paramname"><em>memory_type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function for query the max size of continuous memory block in the preloader pisplit heap memory. </p>
<p><br />
</p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">memory_type</td><td>defined the memory type of preloader heap.<br />
 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the max size of continuous memory block in the preloader pisplit heap memory.<br />
</dd></dl>

</div>
</div>
<a class="anchor" id="gafb9f4dbdd65f14ef80eb23cbb5a97972"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function initializes the preloader hardware and software with basic functionality. </p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>User must call one time for preloader basic environment setup. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;preloader_pisplit_error_handling_t err_status;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;if(PRELOADER_PISPLIT_XTLIB_NO_ERR != err_status)</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    printf(&quot;preloader_pisplit_init() error code:%d !!!!&quot;,err_status);</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    while(1);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;}</div></div><!-- fragment --> </dd></dl>

</div>
</div>
<a class="anchor" id="ga1c50684b04546f0c6c0faf8539de7988"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_load </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a>&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__preloader__enum.html#gaf1359f845ace09ade712c90e967694d7">preloader_pisplit_memory_type_t</a>&#160;</td>
          <td class="paramname"><em>code_memory_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__preloader__enum.html#gaf1359f845ace09ade712c90e967694d7">preloader_pisplit_memory_type_t</a>&#160;</td>
          <td class="paramname"><em>data_memory_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function do a pisplit library dynamic pre-load. </p>
<p>The function is non-blocking, just allocate code and data region memory and start DMA to do pre-load,so the pre-load job is ongoing when this function return. When DMA tansfer done, the customer callback will be called. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*handle</td><td>specifies user pisplit library handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">code_memory_type</td><td>specifies which memory type need to load for code </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_memory_type</td><td>specifies which memory type need to load for data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>User must the pisplit library handle before calling this function. </dd></dl>

</div>
</div>
<a class="anchor" id="ga2a542fdc86ca0e5395e94a467986f559"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_load_v1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a>&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>code_load_address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data_load_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function do a pisplit library dynamic pre-load. </p>
<p>The function is non-blocking, just allocate code and data region memory and start DMA to do pre-load,so the pre-load job is ongoing when this function return. When DMA tansfer done, the customer callback will be called. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*handle</td><td>specifies user pisplit library handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">code_load_address</td><td>specifies code load address. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_load_address</td><td>specifies data load address. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>User must the pisplit library handle before calling this function. </dd></dl>

</div>
</div>
<a class="anchor" id="gaf5cff19f051f69fd7835b81d6dd99bcc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* preloader_pisplit_malloc_memory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__enum.html#gaf1359f845ace09ade712c90e967694d7">preloader_pisplit_memory_type_t</a>&#160;</td>
          <td class="paramname"><em>memory_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function for malloc memory from preloader pisplit heap memory. </p>
<p><br />
 Because SDK reserved all free memory for preloader pisplit heap,so if use want to use extra memory, can use this API to malloc.<br />
 Actually, the memory of preloader pisplit heap just for the memory allocation of library code region and data region. User don't care this, the preloader API of <a class="el" href="group__preloader__pisplit.html#ga1c50684b04546f0c6c0faf8539de7988" title="This function do a pisplit library dynamic pre-load. ">preloader_pisplit_load</a> will do it.<br />
 But if a pisplit library need a extra data memory allocated by main program, can use this API to allocate memory from preloader heap. <br />
</p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">memory_type</td><td>defined the memory type of preloader heap.<br />
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>defined the mmeory of size</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the allocate buffer address. If the return value is NULL means allocate memory fail.<br />
</dd></dl>
<dl class="section note"><dt>Note</dt><dd><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// for example, a pisplit library need a extra data memory allocated by main program.</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  // the function of lib_foo(void* memory) is the library function</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  //the function of lib_foo_need_memory() also is the library function, and it can query the data memory requirement by the function of lib_foo(). </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  //pseudocode as below:</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  preloader_pisplit_load(XXX,YYY);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  // load library firstly,when load done</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  //now to call library entries on mian program</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  uint32_t = memory_size;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  void* extra_memory;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  memory_size = lib_foo_need_memory();</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  extra_memory = preloader_pisplit_malloc_memory(PRELOADER_DRAM,memory_size);</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  foo(extra_memory);</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  preloader_pisplit_free_memory(PRELOADER_DRAM,extra_memory);</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  preloader_pisplit_unload(XXX);</div></div><!-- fragment --> </dd></dl>

</div>
</div>
<a class="anchor" id="gac1e985c28b7067ed407d83867e8b3945"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_query_library_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a>&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>p_code_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>p_data_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function for query the library relocation size. </p>
<p><br />
</p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*handle</td><td>specifies user pisplit library handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*p_code_size</td><td>get the library code size. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">*p_data_size</td><td>get the library data size. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;uint32_t data_size,code_size;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;preloader_pisplit_query_library_size(p_dsp_pisplit_library_handle,&amp;code_size,&amp;data_size);</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;printf(&quot;code size:%d, data size:%d&quot;,code_size,data_size);</div></div><!-- fragment --> </dd></dl>

</div>
</div>
<a class="anchor" id="ga1c431d392e5b175370b82e2cfb021f7a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_release_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a>&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function do a pisplit library handle release. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*handle</td><td>specifies user pisplit library handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>User no need to release the hande every time unless the library will never be used. </dd></dl>

</div>
</div>
<a class="anchor" id="ga2bff9afe6f5a08fcde9fbf3450f69c74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_unload </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a>&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function do a pisplit library unload. </p>
<p>If the library will never used or the memory not enough for other critical pispilt library, user can call this function to do unload.Then the memory will be free. After unload, When user want to call this library,should be call <a class="el" href="group__preloader__pisplit.html#ga1c50684b04546f0c6c0faf8539de7988" title="This function do a pisplit library dynamic pre-load. ">preloader_pisplit_load()</a> to load this library again. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*handle</td><td>specifies user pisplit library handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>User call this memory can free the memory allocated by this library. </dd></dl>

</div>
</div>
<a class="anchor" id="ga04a5fdc6b0c14927994b671aff2e8566"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97">preloader_pisplit_error_handling_t</a> preloader_pisplit_unload_v1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__preloader__typedef.html#ga41f6b185f6daa9534b1d930d3c4e6c82">preloader_pisplit_handle_t</a>&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function do a pisplit library unload. </p>
<p>If the library will never used or the memory not enough for other critical pispilt library, user can call this function to do unload.Then the memory will be free. After unload, When user want to call this library,should be call <a class="el" href="group__preloader__pisplit.html#ga1c50684b04546f0c6c0faf8539de7988" title="This function do a pisplit library dynamic pre-load. ">preloader_pisplit_load()</a> to load this library again. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">*handle</td><td>specifies user pisplit library handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__preloader__enum.html#gga315e7f2d5f17f527f911d930dae45c97a53ae1313f9a519f88a81f90cb55e52e7" title="Defines preloader status of no error. ">PRELOADER_PISPLIT_XTLIB_NO_ERR</a> if OK. <br />
 other return value please reference <a class="el" href="group__preloader__enum.html#ga315e7f2d5f17f527f911d930dae45c97" title="This enum defines the preloader error status. ">preloader_pisplit_error_handling_t</a>. <br />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>User call this memory can free the memory allocated by this library. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Dec 29 2023 02:13:18 for AB158x Series DSP API Reference by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
